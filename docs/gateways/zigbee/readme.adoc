= ZigBee Gateway

== Products

* link:https://phoscon.de/en/conbee2[ConBee II]

== Software

* link:https://github.com/marthoc/docker-deconz[Docker Deconz]
* link:https://flows.nodered.org/node/node-red-contrib-deconz[NodeRed deconz]
* link:http://dresden-elektronik.github.io/deconz-rest-doc[Deconz API doc]

== Usage

.Enable dialout
[source,bash]
----
$ sudo usermod -a -G dialout $USER
----

.Run as docker container
[source,bash]
----
$ docker run -d \
    --name=deconz \
    -p 8080:8080 \
    -p 8443:8443 \
    --restart=always \
    -v /etc/localtime:/etc/localtime:ro \
    -v /opt/deconz:/root/.local/share/dresden-elektronik/deCONZ \
    -e DECONZ_WEB_PORT=8080 \
    -e DECONZ_WS_PORT=8443 \
    -e DECONZ_DEVICE=/dev/ttyZigbee \
    --device=/dev/ttyZigbee \
    marthoc/deconz
----

[source,yaml]
----

----

== Deconz API

From link:http://dresden-elektronik.github.io/deconz-rest-doc[Official Deconz API doc]

.Get API token (pre-requisit: browse to Hamburger menu -> Gateway -> Advanced -> Click ‘Authenticate app’)
[source,bash]
----
$ curl -d '{ "devicetype": "Node-RED"}' -H "Content-Type: application/json" -X POST http://192.168.1.46:40450/api
...
# Token is returned
----

.List sensors
[source,bash]
----
$ curl -H "Content-Type: application/json" http://192.168.1.46:40450/api/XXAAXX/sensors | jq .
...
----

.WebSowket
[source,bash]
----
$ curl -H "Content-Type: application/json" http://192.168.1.46:40450/api/XXAAXX/config | jq .

{
  "UTC": "2020-08-23T18:31:17",
  "apiversion": "1.16.0",
  "backup": {
    "errorcode": 0,
    "status": "idle"
  },
  "bridgeid": "XOXOXOXOXO",
  "datastoreversion": "93",
  "devicename": "RaspBee",
  "dhcp": true,
...
  "uuid": "606b08d1-5f14-4032-86cc-xxxxxx",
  "websocketnotifyall": true,
  "websocketport": 40460,
  "whitelist": {
    "XOXOXOXOXO": {
      "create date": "2020-08-22T18:40:34",
      "last use date": "2020-08-22T18:40:34",
      "name": "Node-RED"
    },
 ...
  },
  "zigbeechannel": 15
}
----